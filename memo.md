# 謎解きクイズ作成メモ

## 全体構想

### ストーリーライン
- 主人公: アレックス・チェン（セキュリティエンジニア）
- 所属: Project Aegis
- 状況: 敵組織のシステムの脆弱性を発見後、狙われている
- 目的: 真実を見つけてProject Aegisを守る
- 最初のヒント: 最後にpushしたコミットメッセージ

### 謎解きの設計思考

#### レベル設計
1. **初級**: Base64やシーザー暗号など、基本的なエンコーディング
2. **中級**: 複数の暗号の組み合わせ、プログラミング知識が必要
3. **上級**: セキュリティの専門知識、複雑な暗号解読

#### ターゲット層
- エンジニア（特にセキュリティに興味がある人）
- CTF経験者
- プログラミング経験がある謎解き愛好家

## アイデアメモ

### コミットメッセージの活用
- gitのコミットメッセージに暗号を隠す
- コミットハッシュ自体が次のヒントになる

### 技術的な仕掛け
1. **DNS TXTレコード**: ドメインのTXTレコードにメッセージを隠す
2. **HTTPヘッダー**: カスタムヘッダーに情報を埋め込む
3. **画像のEXIFデータ**: 写真のメタデータに座標や暗号を隠す
4. **QRコードの多層化**: QRコード内にさらに別のQRコードを埋め込む
5. **音声スペクトログラム**: 音声ファイルのスペクトログラムで文字や画像を表現

### プログラミング要素
この部分は保留

### セキュリティ概念の活用
- SQLインジェクションの原理を使った謎解き
- XSSの仕組みを理解していないと解けない問題
- JWTトークンの構造を利用した暗号
- ハッシュの衝突を利用した仕掛け

### ストーリーとの連携
- Project Aegisの内部システムへのアクセス
- 敵組織との駆け引き
- タイムリミットの演出（リアルタイムイベント）
- 複数のエンディング（選択によって変わる）

## 実装上の注意点

### 難易度バランス
- 最初は簡単な問題で達成感を与える
- 徐々に難易度を上げていく
- 行き詰まった時のヒントシステム

### 技術的配慮
- GitHub Actionsを利用して自動検証
- GitHubリポジトリにPull Requestを通じて回答を提出

### 没入感の演出
- リアルなエラーメッセージ
- 実際のツール（git, curl, openssl等）を使用
- 時系列に沿ったストーリー展開

## 今後の検討事項

### 問題の流れ
1. コミットメッセージから最初の暗号を発見
2. 複数の暗号を解いてURLやIPアドレスを特定
3. 特定のサーバーにアクセスして次のヒントを取得
4. セキュリティの知識を使って侵入を模擬
5. 最終的に真実にたどり着く

### 追加アイデア
- ARを使った現実世界との連携
- SNSアカウントを使った情報発信
- 期間限定のイベント
- 協力プレイ要素

## 参考資料
- CTFの問題集
- セキュリティコンテストの過去問
- 暗号化アルゴリズムの実装例
- エスケープルームの設計手法

## 作成進捗メモ（2025年7月8日）

### 完成したファイル
1. **cryptography.md**: 暗号の種類を網羅的に記載。古典暗号からCTF系まで幅広くカバー
2. **tool.md**: ネットワーク、ファイル、Web、地理的要素など多様なリソースを整理
3. **background.md**: アレックス・チェン、Project Aegis、Shadow Collectiveの詳細な設定を構築
4. **security.md**: 実践的なセキュリティ概念を謎解きに活用する方法を体系化
5. **memo.md**: 全体構想とアイデアを記録（このファイル）

### ストーリーと技術の統合案
- アレックスが発見した脆弱性は、Project AegisとShadow Collectiveの両方に影響
- 最初の問題は簡単なBase64デコードから始め、徐々に高度な技術へ
- コミットメッセージ → 暗号解読 → セキュリティ脆弱性の利用 → 真実の発見

### 問題設計の方向性
1. **第1層**: 基本的な暗号（ROT13、Base64）でコミットメッセージを解読
2. **第2層**: GitHubリポジトリやWebサーバーへのアクセス
3. **第3層**: SQLインジェクションやXSSを使った情報取得
4. **第4層**: より高度な暗号とセキュリティ概念の組み合わせ
5. **最終層**: すべての手がかりを統合して真実を明らかに

### 技術的実装のポイント
- Dockerコンテナで隔離された環境を提供
- 実際のgitリポジトリを使用
- 簡易的なWebアプリケーションで脆弱性を実装
- 時限要素を含むリアルタイム性

### エンディングの構想
- マルチエンディング：プレイヤーの選択により結末が変化
- A: Project Aegisを守り、Shadow Collectiveを撃退
- B: 両組織の裏にある真実を暴露
- C: 第三の勢力の存在を発見

## ストーリー展開（story.md更新内容）

### Question01-05の構成
1. **Question01**: アレックスからの最初のメッセージ、GitHubリポジトリへの誘導
2. **Question02**: システムログによる緊迫感の演出、31337ポートの言及
3. **Question03**: 内部協力者からのヒント、GitHub Actions/PR提出方法の説明
4. **Question04**: Shadow Collectiveの脅威、ステガノグラフィーの示唆
5. **Question05**: 最終警告、詩的なメッセージで分散型の考え方を示唆

### 技術要素の組み込み
- GitHubリポジトリ（alexchen-security/project-aegis-logs）を実際に作成
- コミットメッセージ、ハッシュ、ブランチ名に暗号を分散
- GitHub Actionsで自動検証システムを構築
- Pull Requestで回答を提出（AEGIS-で始まる識別子）

### ゲームメカニクス
- 間違った回答3回で24時間のペナルティ（緊張感の演出）
- 時間経過とともにストーリーが進行
- Shadow Collectiveとの競争要素

## ストーリー詳細補完 - タイムライン

### 2022年3月15日 - 入社初日の詳細
- **08:30**: アレックスがビル前に到着。深呼吸をして建物を見上げる
- **08:45**: 受付でビジターバッジを受け取り、エレベーターで人事部へ
- **09:00**: リサとの面談開始。書類手続きと社内規則の説明
- **09:30**: ジェームズ・ワンとの出会い。初対面で彼の温かさに安心感を覚える
- **10:00**: セキュリティクリアランスの手続き。生体認証登録（虹彩、指紋、声紋）
- **11:00**: 47階のセキュリティオペレーションセンター初訪問
- **14:00**: チームメンバーとの顔合わせ。皆がアレックスのMITでの実績を知っていた
- **16:00**: 初日の研修終了。ジェームズから「明日から本番だ」と激励される

### 2025年6月12日 - 運命の72時間開始

#### 00:00-02:00 UTC - 通常業務
- **00:00**: 深夜シフト開始。他のメンバーは帰宅済み
- **00:30**: 定期セキュリティスキャンを開始
- **01:00**: コーヒーブレイク。エチオピア産シングルオリジンを淹れる
- **01:30**: 前日のインシデントレポートを確認
- **02:00**: Network Segment 1-6の監査完了

#### 02:17-02:34 UTC - 発見の瞬間
- **02:17**: Network Segment 7の監査開始
- **02:19**: トラフィックモニターに微細な異常を検知
- **02:21**: パケットキャプチャツール起動
- **02:25**: データストリームの詳細分析開始
- **02:28**: ステガノグラフィーのパターンを認識
- **02:30**: 暗号化されたデータの復号を試みる
- **02:34**: 「Shadow Collective」の文字列を発見、顔面蒼白に

#### 02:35-03:45 UTC - 深掘り調査
- **02:35**: 周囲を確認。セキュリティカメラの死角に移動
- **02:40**: 個人用の暗号化ドライブにデータをコピー開始
- **03:00**: バックドアのコード解析開始
- **03:15**: コーディングスタイルからProject Aegis内部犯の可能性を認識
- **03:30**: 暗号化されたログファイルの存在を発見
- **03:40**: マスターパスワードのブルートフォース開始
- **03:45**: ログファイルの復号に成功、協定の存在を知る

#### 04:00 UTC - Shadow Collective側の動き（並行時系列）
- **04:00**: Ghostがアレックスのアクセスを検知
- **04:02**: Cipherへの緊急報告
- **04:05**: 過激派の動向確認
- **04:08**: Phase 4検討の決定
- **04:10**: 監視継続の指示

#### 04:23-05:15 UTC - 真実との対峙
- **04:23**: 通信記録の精査開始
- **04:30**: AEGIS_COMMANDとSHADOW_PRIMEの通信履歴確認
- **04:45**: 「均衡」システムの全貌を理解
- **05:00**: Protocol Sevenの真の威力を認識
- **05:10**: 誰に報告すべきか葛藤
- **05:15**: 単独行動の決意

#### 05:16-06:00 UTC - 証拠隠滅と準備
- **05:16**: 暗号化システムの設計開始
- **05:30**: 複数の暗号化レイヤーを実装
- **05:45**: データの分散配置計画を立案
- **05:50**: アクセスログの改ざん開始
- **05:55**: 私物の整理（母親の写真、ケビンとの写真）
- **06:00**: オフィスを後にする決断

### アレックスの内部システムアクセス権限
- Level 5 セキュリティクリアランス（最高はLevel 7）
- Network Segment 1-7へのread権限
- 緊急時対応プロトコルへのアクセス
- 暗号化通信システム「AegisNet」の使用権限
- ただし、OMEGA級機密へのアクセスは本来不可

### 逃亡中の経路詳細

#### 2025年6月12日 06:00-19:30 - 初日
- **06:00**: Project Aegisビルを出る
- **06:15**: 最寄りのATMで現金$5,000を引き出し
- **06:30**: 使い捨て携帯を購入
- **07:00**: バスでサンフランシスコ市外へ
- **09:00**: 別のバスに乗り換え、追跡を撹乱
- **12:00**: 小さなダイナーで食事、ニュースをチェック
- **15:00**: 中古車を現金で購入（偽名使用）
- **19:30**: 郊外のモーテルにチェックイン

#### 2025年6月12日 20:45 - 襲撃の詳細
- **20:30**: 異常な静寂に気づく
- **20:35**: 窓から駐車場を確認、黒いSUVを発見
- **20:40**: 脱出準備、ノートPCのデータを暗号化
- **20:43**: 廊下に複数の足音
- **20:45**: ドアが破られる瞬間に窓から脱出
- **20:46**: 2階から飛び降り、左足首を負傷
- **20:48**: 森の中へ逃走

### 技術的詳細

#### アレックスが使用したツール
- **Wireshark**: パケットキャプチャ
- **IDA Pro**: バックドアのリバースエンジニアリング
- **John the Ripper**: パスワードクラック
- **OpenSSL**: 暗号化処理
- **Git**: バージョン管理と秘密の埋め込み
- **Steghide**: ステガノグラフィー
- **自作Pythonスクリプト**: データ分散と暗号化

#### Protocol Sevenの技術仕様（アレックスが解析した範囲）
- 7層構造の各層は独立して動作可能
- マスターキーは5つの断片に分割されている
- 起動には3つ以上の断片が必要
- 各断片は異なる暗号方式で保護
- タイムロック機能：特定の日時まで起動不可

### Shadow Collective内部の動き（補完）

#### 過激派"Anarchy"の動き
- **2025年6月11日**: Protocol Sevenの存在を知る
- **2025年6月12日 06:00**: サンフランシスコへ部隊派遣
- **2025年6月12日 20:00**: アレックスの居場所を特定
- **2025年6月12日 20:45**: モーテル襲撃（Project Aegisと同時刻）

#### Zeroの葛藤
- アレックスがかつての教え子だと認識
- 主流派と過激派の板挟み
- 密かにアレックスの逃亡を支援する可能性を模索

### Project Aegis内部の動き（補完）

#### サラ・ミッチェルCEOの真意
- 「均衡」システムに疑念を持ちながらも維持
- アレックスの才能を早くから認識
- 彼が真実に辿り着くことを予見していた可能性

#### ジェームズ・ワンの行動
- **2025年6月12日 07:00**: アレックスの不在に気づく
- **2025年6月12日 10:00**: 上層部に報告
- **2025年6月12日 18:00**: 独自にアレックスを探し始める
- **2025年6月14日 10:00**: 手紙を発見、涙する

### 暗号化システムの詳細設計

#### Layer 1: 表層
- GitHubリポジトリのREADME
- 一見普通のセキュリティツールのドキュメント
- 特定の行の頭文字を繋げると次のヒント

#### Layer 2: 技術層
- コミットハッシュの特定の文字が座標を示す
- ブランチ名がBase64エンコードされたURL
- Issue番号が暗号鍵の一部

#### Layer 3: 哲学層
- 倫理的な問いかけ
- 「正義とは何か」への回答が次の鍵
- MIT時代の理念への言及

#### Layer 4: 感情層
- ケビンとの思い出に関する質問
- 母親の教えを理解する必要
- 人間性のテスト

#### Layer 5: 選択層
- 3つの道の提示
- 選択によって異なる情報が開示
- 最終的なProtocol Seven制御コード

### 終章への伏線

#### Protocol Sevenを作った人物の正体候補
1. マイケル・リー（CTO）の部下
2. 初期メンバーの誰か
3. 外部から潜入した第三勢力
4. 実はZero本人
5. まだ登場していない人物

#### アレックスの生存可能性
- 倉庫での対峙の結末は意図的に曖昧に
- 「The game has just begun」は録音メッセージ？
- 複数の世界線の可能性を示唆

## キャラクター心理描写の補完

### アレックスの内面変化
#### 入社時（2022年）
- 理想に燃える若きエンジニア
- 世界を守る使命感に満ちている
- Project Aegisへの絶対的な信頼

#### 中期（2023-2024年）
- 実績を積み、自信を深める
- しかし、時折感じる違和感
- 「なぜShadow Collectiveの攻撃パターンは予測可能なのか」

#### 発見直前（2025年6月11日）
- 疲労が蓄積、しかし使命感は健在
- ケビンの事件から3年、復讐心は薄れ正義感に昇華
- 日常に埋没しかけていた疑問が再燃

#### 真実発見後（2025年6月12日）
- 裏切られた怒り→絶望→そして決意へ
- 「組織」ではなく「理念」を守る決断
- 孤独と恐怖、しかし後戻りはできない

### ジェームズ・ワンの複雑な立場
- アレックスを本当の弟のように思っている
- 「均衡」の真実は知らない中間管理職
- アレックスの才能を見抜き、育てた自負
- 手紙を読んだ後の苦悩「なぜ相談してくれなかった」

### サラ・ミッチェルの冷徹な計算
- 感情を表に出さない理由：全てを計算している
- アレックスが真実に辿り着くことを予見
- しかし、組織の安定を最優先に考える
- 内心では「必要悪」への疑問を抱えている

### Ghost（Shadow Collective）の観察者視点
- 全てを見通す諜報のプロフェッショナル
- アレックスへの興味は純粋に知的なもの
- 「均衡」システムの歪みを最も理解している一人
- しかし、自分から動くことはない

## 具体的な場面の補完

### Network Segment 7での発見場面
```
アレックスは、モニターに表示される16進数の羅列を見つめていた。
通常のHTTPSトラフィックに見える。しかし...

「待てよ、このヘッダーのシーケンス...」

彼は気づいた。3バイトごとに現れる特定のパターン。
それは、母親が教えてくれた古典的なステガノグラフィーの手法だった。

手が震える。これは偶然ではない。
誰かが、意図的にデータを隠している。

「解析プログラム、起動」

自作のPythonスクリプトが動き出す。
画面に、徐々に文字が浮かび上がってくる。

S... H... A... D... O... W...

「まさか...」
```

### モーテル襲撃の緊迫した瞬間
```
静寂が不自然だった。
隣の部屋から聞こえていたテレビの音が、いつの間にか消えている。

アレックスは、ベッドから静かに立ち上がった。
カーテンの隙間から外を覗く。

黒いSUV。エンジンは切られているが、中に人影。
プロの配置だ。退路は既に塞がれている。

廊下から、かすかな足音。
訓練された者特有の、音を殺した歩き方。

「3... 2... 1...」

ドアが蹴破られると同時に、アレックスは窓を突き破った。
ガラスの破片が顔を掠める。痛みは感じない。

落下。一瞬の浮遊感。
そして、左足首に走る激痛。

「Target escaping!」

叫び声を背に、彼は闇の中へ走り出した。
```

### アレックスの最後のコーディング
```python
# 廃墟の工場、震える手でキーボードを叩く

def leave_legacy():
    """
    This is not just code.
    This is my testament.
    This is my hope.
    """
    
    # Layer 1: For those who seek
    truth_fragments = distribute_knowledge()
    
    # Layer 2: For those who understand
    ethical_gates = create_moral_checkpoints()
    
    # Layer 3: For those who care
    emotional_keys = embed_humanity_test()
    
    # Layer 4: For those who choose
    final_decision = await_the_worthy()
    
    return "The game has just begun"

# 母さん、あなたの教えは正しかった
# すべての暗号には物語がある
# これは、僕の物語だ
```

## 謎解きへの伏線配置

### コミットメッセージに隠された意味
- 通常のバグ修正に見えるが、特定の文字を抜き出すとメッセージ
- コミット時刻が特定のパターン（フィボナッチ数列など）
- コミットハッシュの先頭6文字が座標を示す

### ファイル構造の秘密
```
project-aegis-logs/
├── README.md          # 表面的な説明
├── src/
│   ├── analyzer.py    # 各ファイルの最初の行がヒント
│   ├── decoder.py     # 関数名の頭文字で単語を形成
│   └── guardian.py    # コメントに暗号化されたデータ
├── docs/
│   └── manual.pdf     # PDFのメタデータに座標
└── .github/
    └── workflows/     # GitHub Actionsで自動検証
```

### 時系列トリック
- 特定の時刻にアクセスすると異なる情報
- コミット履歴の日付が暗号の鍵
- Issue作成日時がパスワードの一部

## 物語の深層テーマ

### 中央集権vs分散
- Project Aegis = 中央集権的な守護
- Shadow Collective = 見せかけの反逆
- アレックスの理想 = 真の分散型セキュリティ

### 信頼の本質
- 組織への信頼 → 裏切り
- 個人への信頼 → ジェームズへの申し訳なさ
- システムへの信頼 → 新たな構築

### 正義の相対性
- Project Aegisの正義：秩序の維持
- Shadow Collectiveの正義：自由の追求
- アレックスの正義：真実と選択の自由

## エンディング後の可能性

### 選択1（真実公表）の10年後
- インターネットは国ごとに分断
- しかし、新たな国際協力の枠組みが誕生
- アレックスは「デジタル革命の父」として歴史に

### 選択2（現状維持）の10年後  
- 表面上は何も変わらない日常
- しかし、内部改革は着実に進行
- 新たなProtocol Eightの開発を阻止

### 選択3（第三の道）の10年後
- 地下組織「Digital Knights」の誕生
- 両組織の影響力は徐々に低下
- 真の意味での「サイバー平和」の実現へ

## 追加設定メモ

### Project Aegisビルの詳細
- 47階建て、ガラスとスチールの現代建築
- 1-10階：ダミー企業のオフィス
- 11-20階：研修施設と会議室
- 21-30階：研究開発部門
- 31-40階：オペレーション部門
- 41-46階：機密エリア（要Level 6以上）
- 47階：セキュリティオペレーションセンター

### アレックスのデスク配置
- 北東の角、窓際
- 3台のモニター（1台は常時ログ表示）
- 引き出しには常に暗号パズルの本
- デスクの下に緊急脱出キット（現金、偽造ID等）

### Shadow Collectiveの拠点
- 表向き：場所不明
- 実際：各大陸に分散した地下施設
- 通信は全て量子暗号化
- メンバー同士も本名を知らない